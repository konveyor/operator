---
kind: Addon
apiVersion: tackle.konveyor.io/v1alpha1
metadata:
  name: {{ analyzer_name }}
  namespace: {{ app_namespace }}
  labels:
    app.kubernetes.io/name: {{ analyzer_service_name }}
    app.kubernetes.io/component: {{ analyzer_component_name }}
    app.kubernetes.io/part-of: {{ app_name }}
spec:
  description: Provides LSP-based source code analysis.
  tasks:
  - {{ analyzer_name }}
  - {{ tech_discovery_name }}
  container:
    name: {{ analyzer_component_name }}
    image: {{ analyzer_fqin }}
    imagePullPolicy: {{ image_pull_policy }}
    resources:
      limits:
        cpu: {{ analyzer_container_limits_cpu }}
        memory: {{ analyzer_container_limits_memory }}
      requests:
        cpu: {{ analyzer_container_requests_cpu }}
        memory: {{ analyzer_container_requests_memory }}
---
kind: Task
apiVersion: tackle.konveyor.io/v1alpha1
metadata:
  namespace: {{ app_namespace }}
  name: {{ analyzer_name }}
spec:
  description: Perform analysis of application source code.
  priority: 10
  dependencies: [ {{ language_discovery_name }} ]

---
kind: Task
apiVersion: tackle.konveyor.io/v1alpha1
metadata:
  namespace: {{ app_namespace }}
  name: {{ tech_discovery_name }}
  labels:
    konveyor.io/discovery: "technology"
spec:
  description: |
    Perform analysis of application source code to determine
    referenced technologies.
  priority: 1
  dependencies: [ {{ language_discovery_name }} ]
  data:
    mode:
      discovery: true
      withDeps: true
    tagger:
      enabled: true
      source: tech-discovery
    rules:
      labels:
        included: ["discovery"]

